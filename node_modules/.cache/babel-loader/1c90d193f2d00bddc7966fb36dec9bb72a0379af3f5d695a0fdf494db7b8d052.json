{"ast":null,"code":"// AI API 服务（支持 OpenAI 和 DeepSeek）\nconst AI_API_KEY = process.env.REACT_APP_AI_API_KEY || process.env.REACT_APP_OPENAI_API_KEY;\nconst AI_API_BASE = 'https://api.deepseek.com/v1';\nconst AI_MODEL = process.env.REACT_APP_AI_MODEL || 'deepseek-chat';\nexport class OpenAIService {\n  static async generateTarotReading(theme, cards, options = {}) {\n    if (!AI_API_KEY) {\n      throw new Error('AI API key not found. Please set REACT_APP_AI_API_KEY in your environment variables.');\n    }\n    const themeNames = {\n      'love': '感情',\n      'study': '学业',\n      'work': '工作',\n      'money': '财运',\n      'health': '健康'\n    };\n    const themeName = themeNames[theme] || theme || '综合主题';\n    const {\n      emotionText = '',\n      spread = '',\n      analysisPattern = '现状-阻碍-趋势'\n    } = options;\n    const hasSpecificTheme = theme && theme !== 'general';\n\n    // 统一的五段结构提示词（参考用户模板）\n    const unifiedPrompt = `作为一位专业的塔罗占卜师，请根据以下信息为求卜者提供详细解读：\n\n${hasSpecificTheme ? `主题：${themeName}` : '主题：综合主题'}\n情绪/问题：${emotionText || '（未提供）'}\n阵式：${spread || '三张牌'}\n抽到的牌：\n1️⃣ ${cards[0].name}（${cards[0].reversed ? '逆位' : '正位'}）\n2️⃣ ${cards[1].name}（${cards[1].reversed ? '逆位' : '正位'}）\n3️⃣ ${cards[2].name}（${cards[2].reversed ? '逆位' : '正位'}）\n\n请严格按以下\"五段结构\"输出，每段之间空行，语言温暖、专业且富有诗意：\n\n💫 一、整体解读\n\n请给出这三张牌连在一起的能量走向（如：内在XX → 机缘XX → 全新XX），用2-4句话点明${hasSpecificTheme ? `在${themeName}方面` : ''}与\"${emotionText || '此问题'}\"的关联，说明关键主题与求卜者应有的姿态。\n\n🌹 二、逐张解析\n\n请逐张详细说明（每张牌独立成段，含emoji图标）：\n\n🦁 第一张：${cards[0].name}（${cards[0].reversed ? '逆位' : '正位'}）\n基本含义：${cards[0].meaning}\n象征意义与当前阶段：${hasSpecificTheme ? `在${themeName}方面，` : ''}说明这张牌代表的核心状态或优势。\n→ 暗示：给出一句具体的行动/心态提示。\n💡 场景化建议：如果求卜者最近有XX调整，这张牌确认/提醒XX。\n\n🔮 第二张：${cards[1].name}（${cards[1].reversed ? '逆位' : '正位'}）\n基本含义：${cards[1].meaning}\n象征意义与挑战/变量：${hasSpecificTheme ? `在${themeName}方面，` : ''}说明这张牌指向的阻碍或转折点。\n→ 时间点/场景：给出具体的时间窗口或可能的契机场景（如\"通过XX、XX、或XX遇到对的人\"）。\n\n🌈 第三张：${cards[2].name}（${cards[2].reversed ? '逆位' : '正位'}）\n基本含义：${cards[2].meaning}\n象征意义与最终走向：${hasSpecificTheme ? `在${themeName}方面，` : ''}说明这张牌代表的结果或方向。\n→ 核心提示：给出一句加引号的关键判断（如\"命运会给你XX，而你需要的是XX\"）。\n→ 补充说明：指出对方/目标可能的特征或需要注意的边界。\n\n🕰 三、时间与结果趋势\n\n从牌序看：\n${cards[0].name}（现阶段）→ XX；\n${cards[1].name}（近期X个月内）→ XX；\n${cards[2].name}（结果）→ XX。\n\n🔸 推断时间：给出具体的时间区间（如\"今年底前（尤其是X月至X月之间）\"），语气肯定但留有弹性。\n\n💗 四、指引与建议\n\n请给出3-5条可执行建议（用短句+冒号格式），覆盖心态、行动与边界感，每条贴合三张牌的能量：\n- XX：具体建议；\n- XX：具体建议；\n- XX：具体建议；\n- XX：具体建议。\n\n✨ 总结结论\n\n用2-3句话收束本次解读，提炼关键判断与优先级；然后给出一句加引号的鼓励语，引导求卜者以正向、轻盈的方式推进下一步。\n\n重要要求：\n1. 不要出现\"general\"字样；${hasSpecificTheme ? `所有内容围绕${themeName}主题展开` : '直接针对问题，不要出现\"在XX方面\"的表述'}；\n2. 三张牌的表述角度必须明显不同，禁止复用句式模板；\n3. 每段都要空行分隔，保持格式清晰；\n4. 语言既要专业又要温暖，给出具体场景与可执行建议，避免抽象空洞。`;\n    try {\n      const response = await fetch(`${AI_API_BASE}/chat/completions`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${AI_API_KEY}`\n        },\n        body: JSON.stringify({\n          model: AI_MODEL,\n          messages: [{\n            role: 'system',\n            content: '你是一位经验丰富的塔罗占卜师，擅长用温暖、专业且富有诗意的话语为人们提供指导。'\n          }, {\n            role: 'user',\n            content: unifiedPrompt\n          }],\n          max_tokens: 2000,\n          temperature: 0.8\n        })\n      });\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`AI API error: ${response.status} - ${errorText}`);\n      }\n      const data = await response.json();\n      return data.choices[0].message.content;\n    } catch (error) {\n      console.error('AI API Error:', error);\n      throw error;\n    }\n  }\n  static async askFollowUp(previousReading, followUpQuestion) {\n    if (!AI_API_KEY) throw new Error('No API key');\n    const messages = [{\n      role: 'system',\n      content: '你是一位温暖、专业且富有同理心的塔罗占卜师。'\n    }, {\n      role: 'user',\n      content: `以下是之前的塔罗解读：\\n${previousReading}`\n    }, {\n      role: 'user',\n      content: `基于以上解读，我还有追问：${followUpQuestion}。请延续语气、给出具体建议。`\n    }];\n    const response = await fetch(`${AI_API_BASE}/chat/completions`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${AI_API_KEY}`\n      },\n      body: JSON.stringify({\n        model: AI_MODEL,\n        messages,\n        max_tokens: 800,\n        temperature: 0.8\n      })\n    });\n    if (!response.ok) throw new Error(`AI API error: ${response.status}`);\n    const data = await response.json();\n    return data.choices[0].message.content;\n  }\n}","map":{"version":3,"names":["AI_API_KEY","process","env","REACT_APP_AI_API_KEY","REACT_APP_OPENAI_API_KEY","AI_API_BASE","AI_MODEL","REACT_APP_AI_MODEL","OpenAIService","generateTarotReading","theme","cards","options","Error","themeNames","themeName","emotionText","spread","analysisPattern","hasSpecificTheme","unifiedPrompt","name","reversed","meaning","response","fetch","method","headers","body","JSON","stringify","model","messages","role","content","max_tokens","temperature","ok","errorText","text","status","data","json","choices","message","error","console","askFollowUp","previousReading","followUpQuestion"],"sources":["/Users/tingting/Documents/AI项目/src/services/openaiService.js"],"sourcesContent":["// AI API 服务（支持 OpenAI 和 DeepSeek）\nconst AI_API_KEY = process.env.REACT_APP_AI_API_KEY || process.env.REACT_APP_OPENAI_API_KEY;\nconst AI_API_BASE = 'https://api.deepseek.com/v1';\nconst AI_MODEL = process.env.REACT_APP_AI_MODEL || 'deepseek-chat';\n\nexport class OpenAIService {\n  static async generateTarotReading(theme, cards, options = {}) {\n    if (!AI_API_KEY) {\n      throw new Error('AI API key not found. Please set REACT_APP_AI_API_KEY in your environment variables.');\n    }\n\n    const themeNames = {\n      'love': '感情',\n      'study': '学业', \n      'work': '工作',\n      'money': '财运',\n      'health': '健康'\n    };\n\n    const themeName = themeNames[theme] || theme || '综合主题';\n    const { emotionText = '', spread = '', analysisPattern = '现状-阻碍-趋势' } = options;\n    \n    const hasSpecificTheme = theme && theme !== 'general';\n    \n    // 统一的五段结构提示词（参考用户模板）\n    const unifiedPrompt = `作为一位专业的塔罗占卜师，请根据以下信息为求卜者提供详细解读：\n\n${hasSpecificTheme ? `主题：${themeName}` : '主题：综合主题'}\n情绪/问题：${emotionText || '（未提供）'}\n阵式：${spread || '三张牌'}\n抽到的牌：\n1️⃣ ${cards[0].name}（${cards[0].reversed ? '逆位' : '正位'}）\n2️⃣ ${cards[1].name}（${cards[1].reversed ? '逆位' : '正位'}）\n3️⃣ ${cards[2].name}（${cards[2].reversed ? '逆位' : '正位'}）\n\n请严格按以下\"五段结构\"输出，每段之间空行，语言温暖、专业且富有诗意：\n\n💫 一、整体解读\n\n请给出这三张牌连在一起的能量走向（如：内在XX → 机缘XX → 全新XX），用2-4句话点明${hasSpecificTheme ? `在${themeName}方面` : ''}与\"${emotionText || '此问题'}\"的关联，说明关键主题与求卜者应有的姿态。\n\n🌹 二、逐张解析\n\n请逐张详细说明（每张牌独立成段，含emoji图标）：\n\n🦁 第一张：${cards[0].name}（${cards[0].reversed ? '逆位' : '正位'}）\n基本含义：${cards[0].meaning}\n象征意义与当前阶段：${hasSpecificTheme ? `在${themeName}方面，` : ''}说明这张牌代表的核心状态或优势。\n→ 暗示：给出一句具体的行动/心态提示。\n💡 场景化建议：如果求卜者最近有XX调整，这张牌确认/提醒XX。\n\n🔮 第二张：${cards[1].name}（${cards[1].reversed ? '逆位' : '正位'}）\n基本含义：${cards[1].meaning}\n象征意义与挑战/变量：${hasSpecificTheme ? `在${themeName}方面，` : ''}说明这张牌指向的阻碍或转折点。\n→ 时间点/场景：给出具体的时间窗口或可能的契机场景（如\"通过XX、XX、或XX遇到对的人\"）。\n\n🌈 第三张：${cards[2].name}（${cards[2].reversed ? '逆位' : '正位'}）\n基本含义：${cards[2].meaning}\n象征意义与最终走向：${hasSpecificTheme ? `在${themeName}方面，` : ''}说明这张牌代表的结果或方向。\n→ 核心提示：给出一句加引号的关键判断（如\"命运会给你XX，而你需要的是XX\"）。\n→ 补充说明：指出对方/目标可能的特征或需要注意的边界。\n\n🕰 三、时间与结果趋势\n\n从牌序看：\n${cards[0].name}（现阶段）→ XX；\n${cards[1].name}（近期X个月内）→ XX；\n${cards[2].name}（结果）→ XX。\n\n🔸 推断时间：给出具体的时间区间（如\"今年底前（尤其是X月至X月之间）\"），语气肯定但留有弹性。\n\n💗 四、指引与建议\n\n请给出3-5条可执行建议（用短句+冒号格式），覆盖心态、行动与边界感，每条贴合三张牌的能量：\n- XX：具体建议；\n- XX：具体建议；\n- XX：具体建议；\n- XX：具体建议。\n\n✨ 总结结论\n\n用2-3句话收束本次解读，提炼关键判断与优先级；然后给出一句加引号的鼓励语，引导求卜者以正向、轻盈的方式推进下一步。\n\n重要要求：\n1. 不要出现\"general\"字样；${hasSpecificTheme ? `所有内容围绕${themeName}主题展开` : '直接针对问题，不要出现\"在XX方面\"的表述'}；\n2. 三张牌的表述角度必须明显不同，禁止复用句式模板；\n3. 每段都要空行分隔，保持格式清晰；\n4. 语言既要专业又要温暖，给出具体场景与可执行建议，避免抽象空洞。`;\n\n    try {\n      const response = await fetch(`${AI_API_BASE}/chat/completions`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${AI_API_KEY}`\n        },\n        body: JSON.stringify({\n          model: AI_MODEL,\n          messages: [\n            {\n              role: 'system',\n              content: '你是一位经验丰富的塔罗占卜师，擅长用温暖、专业且富有诗意的话语为人们提供指导。'\n            },\n            {\n              role: 'user',\n              content: unifiedPrompt\n            }\n          ],\n          max_tokens: 2000,\n          temperature: 0.8\n        })\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`AI API error: ${response.status} - ${errorText}`);\n      }\n\n      const data = await response.json();\n      return data.choices[0].message.content;\n    } catch (error) {\n      console.error('AI API Error:', error);\n      throw error;\n    }\n  }\n\n  static async askFollowUp(previousReading, followUpQuestion) {\n    if (!AI_API_KEY) throw new Error('No API key');\n    const messages = [\n      { role: 'system', content: '你是一位温暖、专业且富有同理心的塔罗占卜师。' },\n      { role: 'user', content: `以下是之前的塔罗解读：\\n${previousReading}` },\n      { role: 'user', content: `基于以上解读，我还有追问：${followUpQuestion}。请延续语气、给出具体建议。` }\n    ];\n    const response = await fetch(`${AI_API_BASE}/chat/completions`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${AI_API_KEY}`\n      },\n      body: JSON.stringify({ model: AI_MODEL, messages, max_tokens: 800, temperature: 0.8 })\n    });\n    if (!response.ok) throw new Error(`AI API error: ${response.status}`);\n    const data = await response.json();\n    return data.choices[0].message.content;\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}