// 演示版本的解读服务（不依赖OpenAI API）
export class DemoService {
  static async generateTarotReading(theme, cards, options = {}) {
    // 模拟API延迟
    await new Promise(resolve => setTimeout(resolve, 2000));

    const themeNames = {
      'love': '感情',
      'study': '学业', 
      'work': '工作',
      'money': '财运',
      'health': '健康'
    };

    const themeName = themeNames[theme] || '综合主题';
    const { emotionText = '', spread = '' } = options;
    const hasSpecificTheme = theme && theme !== 'general';
    
    // 按照用户模板统一生成五段结构
    const card1 = cards[0];
    const card2 = cards[1];
    const card3 = cards[2];
    
    const pos1 = card1.reversed ? '逆位' : '正位';
    const pos2 = card2.reversed ? '逆位' : '正位';
    const pos3 = card3.reversed ? '逆位' : '正位';
    
    return `💫 一、整体解读

这组三张牌连在一起，能量走向是：
${card1.name}（${pos1}）→ ${card2.name}（${pos2}）→ ${card3.name}（${pos3}）

${hasSpecificTheme ? `在${themeName}方面，` : ''}这个牌阵显示出"从内在积蓄—到外在转机—再到新的开始"的流动节奏。${emotionText ? `关于"${emotionText}"这个问题，` : ''}关键在于你是否愿意顺应能量的推进，主动迎接变化与机遇。
${hasSpecificTheme ? `今年的${themeName}主题` : '当前的议题'}不是被动等待，而是在稳定中创造流动、在行动中把握契机。

🌹 二、逐张解析

🦁 第一张：${card1.name}（${pos1}）

基本含义：${card1.meaning}
象征${pos1 === '正位' ? '温柔的掌控与内在平衡' : '需要调整的内在状态'}。${hasSpecificTheme ? `在${themeName}方面，` : ''}这代表你当前${pos1 === '正位' ? '已学会用稳定而坚定的方式对待目标' : '可能在心态或方法上需要重新校准'}。
→ 暗示：你正处于一个"${pos1 === '正位' ? '磁场稳定、能量上升' : '需要重新聚焦'}"的阶段，${pos1 === '正位' ? '别人会感受到你散发的力量' : '调整后会更顺畅'}。

💡 如果最近你有在自我成长、能力提升或外在形象上做调整，这张牌确认：这些努力${pos1 === '正位' ? '正在提升你的整体能量' : '值得继续投入'}。

🔮 第二张：${card2.name}（${pos2}）

基本含义：${card2.meaning}
象征${pos2 === '正位' ? '转运与机会的到来' : '暂时的停滞或需要耐心'}。${hasSpecificTheme ? `在${themeName}方面，` : ''}${pos2 === '正位' ? '命运正在帮你打开新的阶段，有新的对象、关系、或契机正在靠近' : '目前可能需要等待更好的时机，不宜急躁'}。
→ 时间点：${pos2 === '正位' ? `通常暗示在近期（如${spread.includes('疗愈') ? '1-2个月' : '季节交替、未来3个月'}）会有意想不到的转机` : '需要耐心观察，转机会在你调整策略后出现'}。
→ 场景：${pos2 === '正位' ? '可能通过旅行、换环境、社交活动、课程、或朋友介绍而遇到关键节点，而非在日常圈子中' : '当前圈子可能受限，适当拓展视野会更有帮助'}。

🌈 第三张：${card3.name}（${pos3}）

基本含义：${card3.meaning}
${pos3 === '正位' ? '代表全新的旅程、真诚无畏的心态与"勇敢开始"的信号' : '提示需要调整节奏或重新审视目标'}。
这张牌告诉你：

"${pos3 === '正位' ? '命运会给你一个新的开始，而你需要的是勇敢地踏出去' : '放慢脚步、重新规划，机会会在更合适的时机出现'}"

→ ${pos3 === '正位' ? `有时${card3.name}出现，也象征对方/目标是自由、不按套路的，可能与你预期不同，但关系/过程会充满新鲜感` : '它提醒你不要急于求成，稳扎稳打更能达成目标'}。
→ ${pos3 === '正位' ? '不要带着过去的标准看待新的人/事，因为这段经历可能"超出你熟悉的范式"' : '建议先整理思路，再做下一步决策'}。

🕰 三、时间与结果趋势

从牌序看：

${card1.name}（现阶段）→ ${pos1 === '正位' ? '你正在积蓄能量与吸引力' : '需要调整内在状态'};

${card2.name}（近期${spread.includes('疗愈') ? '1-2个月' : '3个月'}内）→ ${pos2 === '正位' ? '命运之门开始转动，机会临近' : '暂处观望期，适合准备与调整'};

${card3.name}（结果）→ ${pos3 === '正位' ? '新阶段出现，且带有"轻盈、自在、突然而来"的气息' : '需要更长时间沉淀，但最终会有收获'}。

🔸 推断时间：${pos2 === '正位' && pos3 === '正位' ? `你有很大概率在${spread.includes('疗愈') ? '近2-3个月' : '今年底前（尤其是接下来的季度内）'}看到明显进展或${hasSpecificTheme ? themeName : '目标'}契机` : '建议给自己3-6个月的调整期，不必急于一时'}。

💗 四、指引与建议

${pos1 === '正位' && pos2 === '正位' ? 
`敞开心、别预设框架：命运会带来意想不到的人/机会，不必过早评判"合不合适"；

多出门、多交流：${card2.name}+${card3.name}都属于"行动系"能量，${hasSpecificTheme ? themeName : '机遇'}在流动中发生；

维持自信与温柔的平衡：${card1.name}代表内在力量，你的坚定与温柔是关键魅力；

不要带旧经验的阴影：${card3.name}提醒你以"空白心态"去迎接新的关系/阶段。` :
`稳住节奏，不急不躁：当前能量尚在积累，过早行动可能适得其反；

专注提升自己：${card1.name}${pos1 === '逆位' ? '逆位' : ''}提示内在调整是当务之急；

观察时机，适时出击：${card2.name}${pos2 === '逆位' ? '逆位' : ''}说明需要等待更好的窗口；

保持耐心与信心：最终${card3.name}会带来结果，但需要时间沉淀。`}

✨ 总结结论

${pos2 === '正位' && pos3 === '正位' ?
`${hasSpecificTheme ? `今年你的${themeName}确实有"缘分/机会启动"的迹象，尤其是近期，可能会出现关键的转折点` : '你正处在一个能量上升、机会临近的阶段'}。
你现在所要做的，是让自己保持轻盈、相信命运、主动创造流动的机会。` :
`${hasSpecificTheme ? `你的${themeName}正处在调整与沉淀的过程中，不必着急` : '当前是积累与准备的阶段'}。
保持稳定的节奏与清醒的判断，持续的微小行动会汇聚成看得见的改变。`}`;
  }

  static async askFollowUp(previousReading, followUpQuestion) {
    await new Promise(r => setTimeout(r, 800));
    return `关于你的追问「${followUpQuestion}」，基于先前的解读，我给出进一步的建议：\n\n- 明确一件可以在本周内完成的小动作；\n- 选择一位可以倾诉或协作的人；\n- 记录今天让你松一口气的三件小事。\n\n保持温柔且稳定的节奏，改变会在持续的微小行动中发生。`;
  }

  static async generateBaziReading(birthInfo) {
    await new Promise(resolve => setTimeout(resolve, 1500));
    return `🌠 命主生辰信息
${birthInfo}

一、八字总览
- 五行整体呈现「水木旺、土金略弱」的格局，适合走学习、创意、咨询、传播等需要灵感与表达的路径。
- 日主气质通透、反应快，遇事更偏理性判断，但内心需要稳定的情感支撑。

二、四柱解析
- 年柱：家族基础稳健，长辈多支持，但也期望你自立；
- 月柱：成长环境重视学习与礼仪，个性中透出谨慎与优雅；
- 日柱：内心敏锐，情绪细腻，适合在文字、设计、教育、心理等领域深耕；
- 时柱：晚年人脉与资源渐丰，有机会转向教练/顾问型角色。

三、神煞提示
- 文昌入命：学习力强，适合持续进修；
- 桃花坐命：人缘佳，需保持界限感；
- 驿马动象：人生阶段多有迁移或职业转换，保持弹性更顺利。

四、大运与流年
- 近十年（大运）宜「先积累、后放手」：前半段夯实专业，下半段主动出击；
- 近两年流年会强调人际合作，建议勇敢寻求协作或伙伴关系；
- 2026-2028 年是事业突破期，可提前布局。

五、人生阶段
- 幼年：乖巧懂事，易成为家人安心的对象；
- 青少年：学习压力不小，但能靠自律取得好成绩；
- 青年：人脉拓展、恋爱运升温，记得辨别真正契合的伙伴；
- 中年：事业能见度提升，适合转向管理 / 咨询角色；
- 晚年：享受分享与教学的乐趣，生活节奏更自由。

六、专项建议
- 感情：保持真诚沟通，适度表达需求；
- 学业 / 学习：善用写作、演讲、课程等渠道巩固影响力；
- 工作 / 事业：结合兴趣 + 专业形成独特定位；
- 财富：稳健理财、分散投资，关注长期复利；
- 健康：注意肩颈、睡眠与消化系统，动静结合。

七、总结
你此生的功课是「在温柔中建立力量、在流动中找到定心」。保持自律 + 柔软，命运会在关键节点推你一把。
“心向光处，脚步自然稳健。”`;
  }
}
